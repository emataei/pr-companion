const fs = require('fs');
const { createOrUpdateComment, getPRNumber } = require('./pr-comment-utils');

async function postDocumentationSuggestionsComment({ github, context }) {
  const prNumber = getPRNumber(context);
  if (!prNumber) {
    console.log('No PR number found, skipping documentation comment');
    return;
  }
  
  // Load documentation suggestions
  let docsContent = '';
  try {
    docsContent = fs.readFileSync('.code-analysis/outputs/documentation_suggestions.md', 'utf8');
    console.log('âœ… Using documentation suggestions');
  } catch (error) {
    console.log('Could not read documentation suggestions:', error.message);
    docsContent = `## Documentation Update Suggestions

*Documentation analysis was not completed. Check workflow logs for details.*
`;
  }
  
  // Add workflow reference to docs
  docsContent += `

---

*Generated by [PR Visuals and Documentation workflow](https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId})*
`;
  
  await createOrUpdateComment(
    github, 
    context, 
    prNumber, 
    docsContent,
    'Documentation Update Suggestions',
    'pr-documentation-suggestions'
  );
}

module.exports = postDocumentationSuggestionsComment;
